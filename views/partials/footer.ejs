
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>

    <script>

      document.addEventListener("DOMContentLoaded", () => {
        const searchInput = document.getElementById('searchInput');
        const suggestions = document.getElementById('suggestions');
        const typeSelect = document.getElementById('typeSelect');

        searchInput.addEventListener('input', async () => {
          const query = searchInput.value.trim();
          const type = typeSelect.value;

          if (!query) {
            suggestions.style.display = 'none';
            suggestions.innerHTML = '';
            return;
          }

          try {
            const response = await fetch(`/search?query=${encodeURIComponent(query)}&type=${type}`);
            const data = await response.json();

            if (data.length === 0) {
              suggestions.style.display = 'none';
              suggestions.innerHTML = '';
              return;
            }

            suggestions.innerHTML = '';
            data.forEach(item => {
              const li = document.createElement('li');
              li.className = 'list-group-item list-group-item-action d-flex align-items-center';
              li.style.cursor = 'pointer';

              const img = document.createElement('img');
              img.src = item.cover || "https://via.placeholder.com/40x60?text=No+Image";
              img.alt = item.title;
              img.style.width = '40px';
              img.style.height = '60px';
              img.style.objectFit = 'cover';
              img.style.marginRight = '10px';
              img.style.borderRadius = '5px';

              const span = document.createElement('span');
              span.textContent = item.title;

              li.appendChild(img);
              li.appendChild(span);

              li.addEventListener('click', async () => {
                searchInput.value = item.title;
                suggestions.style.display = 'none';

                const type = typeSelect.value;

                // Send the clicked item to backend
                try {
                  const response = await fetch('/add', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                      title: item.title,
                      cover_url: item.cover,
                      type: type,
                    }),
                  });

                  const result = await response.json();
                  if (result.success) {
                    alert(`${item.title} added to your list!`);
                    location.reload(); // optional â€“ reload page to show new item
                  } else {
                    alert('Already added or failed to add.');
                  }
                } catch (err) {
                  console.error('Error adding show:', err);
                }
              });

              suggestions.appendChild(li);
          });

            suggestions.style.display = 'block';
          } catch (err) {
            console.error(err);
          }
        });

        // Hide suggestions when clicking outside
        document.addEventListener('click', (e) => {
          if (!searchInput.contains(e.target) && !suggestions.contains(e.target)) {
            suggestions.style.display = 'none';
          }
        });

      });
        
    </script>
  </body>
</html>